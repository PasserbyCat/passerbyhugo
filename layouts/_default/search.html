<div id="searchbox"></div>
<div id="hits"></div>

<script>
  const searchClient = algoliasearch('{{ .Site.Params.algolia_app_id }}', '{{ .Site.Params.algolia_search_api_key }}');
  const index = searchClient.initIndex('{{ .Site.Params.algolia_index_name }}');

  autocomplete({
    container: '#searchbox',
    placeholder: '搜索...',
    getSources({ query }) {
      return [
        {
          sourceId: 'pages',
          getItems() {
            return index.search(query).then(({ hits }) => {
              return hits;
            });
          },
          templates: {
            item({ item, components }) {
              return `<a href="${item.url}">${components.Highlight({ hit: item, attribute: 'title' })}</a>`;
            },
          },
        },
      ];
    },
  });

  index.search('').then(({ hits }) => {
    const container = document.querySelector('#hits');
    hits.forEach(hit => {
      const item = document.createElement('div');
      item.innerHTML = `<a href="${hit.url}">${hit.title}</a>`;
      container.appendChild(item);
    });
  });
</script>